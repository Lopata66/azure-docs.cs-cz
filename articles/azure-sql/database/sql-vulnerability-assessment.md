---
title: Posouzení ohrožení zabezpečení SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Přečtěte si, jak nakonfigurovat posouzení ohrožení zabezpečení SQL a interpretovat sestavy hodnocení na Azure SQL Database, spravované instance Azure SQL a Azure synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: mibar
ms.author: mibar
ms.reviewer: vanto
ms.date: 09/21/2020
tags: azure-synapse
ms.openlocfilehash: f3ca5c1bab503693ffed39d096a3dfd5f30046ad
ms.sourcegitcommit: 4bebbf664e69361f13cfe83020b2e87ed4dc8fa2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/01/2020
ms.locfileid: "91619504"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Posouzení ohrožení zabezpečení SQL vám pomůže identifikovat slabá místa databáze.
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Posouzení ohrožení zabezpečení SQL je snadno nakonfigurovaná služba, která může zjišťovat, sledovat a pomáhat při nápravě potenciálních ohrožení zabezpečení databáze. Můžete ji aktivně využít ke zlepšení zabezpečení vaší databáze.

Posouzení ohrožení zabezpečení je součástí nabídky [Azure Defender pro SQL](azure-defender-for-sql.md) , což je jednotný balíček pro pokročilé funkce zabezpečení SQL. K posouzení ohrožení zabezpečení se dá využít a spravovat prostřednictvím centrálního portálu Azure Defender pro SQL Portal.

> [!NOTE]
> Posouzení ohrožení zabezpečení je podporované pro Azure SQL Database, Azure SQL Managed instance a Azure synapse Analytics (dřív SQL Data Warehouse). Databáze v Azure SQL Database, Azure SQL Managed instance a Azure synapse Analytics se ve zbývající části tohoto článku společně nazývají databáze a server odkazuje na [Server](logical-servers.md) , který je hostitelem databází pro Azure SQL Database a Azure synapse.

## <a name="vulnerability-assessment"></a>Posouzení ohrožení zabezpečení

Posouzení ohrožení zabezpečení SQL je služba, která poskytuje přehled o stavu zabezpečení. Posouzení ohrožení zabezpečení zahrnuje akční kroky pro řešení problémů se zabezpečením a vylepšení zabezpečení databáze. Může vám to usnadnit:

- Splnění požadavků na dodržování předpisů, které vyžadují sestavy kontroly databáze.
- Splnění standardů ochrany osobních údajů.
- Monitorujte dynamické databázové prostředí, kde je obtížné sledovat změny.

Posouzení ohrožení zabezpečení je skenovací služba integrovaná do Azure SQL Database. Služba využívá znalostní bázi pravidel, která označují bezpečnostní hrozby. Zvýrazňuje odchylky od osvědčených postupů, jako jsou například nepřesné konfigurace, nadměrné oprávnění a nechráněná citlivá data.

Tato pravidla jsou založená na osvědčených postupech Microsoftu a zaměřuje se na problémy zabezpečení, které představují největší rizika pro vaši databázi a jejich cenná data. Zahrnují problémy na úrovni databáze a problémy se zabezpečením na úrovni serveru, jako jsou nastavení brány firewall serveru a oprávnění na úrovni serveru. Tato pravidla také reprezentují mnohé z požadavků různých regulativních orgánů pro splnění standardů dodržování předpisů.

Výsledky kontroly zahrnují akční kroky k vyřešení jednotlivých problémů a v případě potřeby vám poskytnou přizpůsobené skripty pro nápravu. Můžete přizpůsobit sestavu posouzení pro vaše prostředí nastavením přijatelného směrného plánu pro:

- Konfigurace oprávnění
- Konfigurace funkcí
- Nastavení databáze

## <a name="implement-vulnerability-assessment"></a>Implementace posouzení ohrožení zabezpečení

Posouzení ohrožení zabezpečení se implementuje v následujících krocích:

### <a name="1-run-a-scan"></a>1. spustit kontrolu

1. V [Azure Portal](https://portal.azure.com)můžete přejít do Azure SQL Database, spravované instance SQL nebo prostředku Azure synapse.

1. V záhlaví **zabezpečení** vyberte **Security Center**.

1. Pak v podokně **posouzení ohrožení zabezpečení** klikněte na **vybrat úložiště** a otevřete podokno nastavení posouzení ohrožení zabezpečení pro celý server nebo spravovanou instanci.  

    > [!NOTE]
    > Další informace o ukládání kontrol ohrožení zabezpečení za brány firewall a virtuální sítě najdete v článku [ukládání výsledků kontroly vyhodnocování ohrožení zabezpečení v účtu úložiště přístupném za brány firewall a virtuální sítě](sql-database-vulnerability-assessment-storage.md).

1. Nakonfigurujte účet úložiště, ve kterém se budou ukládat výsledky kontroly pro všechny databáze na serveru nebo na spravované instanci. Informace o účtech úložiště najdete v tématu informace [o účtech úložiště Azure](../../storage/common/storage-account-create.md). Po nakonfigurování úložiště vyberte **Vyhledat** pro kontrolu ohrožení zabezpečení databáze.

![Kontrola databáze](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > Kontrola je odlehčená a bezpečná. Spuštění a je výhradně jen pro čtení, trvá několik sekund. Neprovádí žádné změny v databázi.

### <a name="2-view-the-report"></a>2. zobrazení sestavy

Po dokončení kontroly se sestava kontroly automaticky zobrazí v Azure Portal. V sestavě se zobrazí přehled stavu zabezpečení. Zobrazuje počet zjištěných problémů a jejich příslušné závažnost. Výsledky zahrnují upozornění na odchylky od osvědčených postupů a snímek nastavení souvisejících se zabezpečením, jako jsou například objekty zabezpečení databáze a role a jejich přidružená oprávnění. Zpráva o kontrole také poskytuje mapu citlivých dat zjištěných ve vaší databázi. Zahrnuje doporučení pro klasifikaci těchto dat pomocí [zjišťování a klasifikace dat](data-discovery-and-classification-overview.md).

![Zobrazení sestavy](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analyzujte výsledky a vyřešte problémy.

Zkontrolujte výsledky a určete zjištění v sestavě, které mají ve vašem prostředí skutečné problémy se zabezpečením. Pokud chcete zjistit dopad hledání a proč se jednotlivá kontrola zabezpečení nezdařila, přejděte k podrobnostem každého neúspěšného výsledku. K vyřešení tohoto problému použijte informace o nápravě, které poskytuje tato sestava.

![Analyzovat sestavu](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. nastavení standardních hodnot

Při kontrole výsledků hodnocení můžete označit konkrétní výsledky jako přijatelné *standardní hodnoty* ve vašem prostředí. Směrný plán je v podstatě přizpůsobením způsobu hlášení výsledků. Výsledky, které se shodují se směrným plánem, se považují za při následné kontrole. Po vytvoření směrného plánu zabezpečení vyhodnocování ohrožení zabezpečení pouze hlásí pouze odchylky ze směrného plánu. Tímto způsobem můžete zaměřit pozornost na relevantní problémy.

![Nastavení standardních hodnot](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Spusťte novou kontrolu, aby se zobrazila vaše přizpůsobená sestava sledování.

Po dokončení nastavení **standardních hodnot pravidel**spusťte novou kontrolu a zobrazte přizpůsobenou sestavu. Posouzení ohrožení zabezpečení nyní hlásí pouze bezpečnostní problémy, které se odchylují od vašeho schváleného základního stavu.

![Zobrazit přizpůsobenou sestavu](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

Posouzení ohrožení zabezpečení se teď dá použít k monitorování, jestli vaše databáze udržuje vysokou úroveň zabezpečení a jestli jsou splněné zásady vaší organizace. Pokud jsou vyžadovány sestavy dodržování předpisů, mohou být sestavy posouzení ohrožení zabezpečení užitečné pro usnadnění procesu dodržování předpisů.

### <a name="6-set-up-periodic-recurring-scans"></a>6. nastavení pravidelného opakovaného prohledávání

Pokud chcete zapnout **pravidelné opakované kontroly**, přečtěte si nastavení posouzení ohrožení zabezpečení. Toto nastavení nakonfiguruje posouzení ohrožení zabezpečení pro automatické spuštění prohledávání databáze jednou za týden. Na e-mailové adresy, které poskytnete, se pošle souhrn výsledků kontroly.

![nastavení opakujících se kontrol](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Export hodnotící sestavy

Vyberte **Exportovat výsledky kontroly** , chcete-li vytvořit sestavu aplikace Excel ke stažení pro výsledek kontroly. Tato sestava obsahuje kartu Souhrn, která zobrazuje souhrn posouzení. Sestava obsahuje všechny neúspěšné kontroly. Obsahuje také kartu **výsledky** , která obsahuje úplnou sadu výsledků kontroly. Výsledky zahrnují všechny kontroly, které byly spuštěny, a podrobnosti o výsledku pro každý z nich.

### <a name="8-view-scan-history"></a>8. Zobrazit historii prohledávání

V podokně posouzení ohrožení zabezpečení vyberte **historii kontroly** , chcete-li zobrazit historii všech kontrol, které byly dříve spuštěny v této databázi. Kliknutím na konkrétní kontrolu v seznamu zobrazíte podrobné výsledky této kontroly.

Posouzení ohrožení zabezpečení se teď dá použít k monitorování, jestli vaše databáze udržuje vysokou úroveň zabezpečení a jestli jsou splněné zásady vaší organizace. Pokud jsou vyžadovány sestavy dodržování předpisů, mohou být sestavy posouzení ohrožení zabezpečení užitečné pro usnadnění procesu dodržování předpisů.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Správa posouzení ohrožení zabezpečení pomocí Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> PowerShell Azure Resource Manager modul je stále podporován, ale všechny budoucí vývojové prostředí jsou pro modul AZ. SQL. Tyto rutiny naleznete v tématu [AzureRM. SQL](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Argumenty pro příkazy v modulech AZ a v modulech AzureRm jsou v podstatě identické.

Pomocí rutin Azure PowerShell můžete programově spravovat posouzení ohrožení zabezpečení. Podporované rutiny jsou:

| Název rutiny jako odkaz | Popis |
| :-------------------- | :---------- |
| [Clear – AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Vymaže směrný plán pravidla posouzení ohrožení zabezpečení.<br/>Nejdřív nastavte základní hodnotu před použitím této rutiny k jejímu vymazání. |
| [Clear – AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení databáze. |
| [Clear – AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Vymaže standardní hodnotu pravidla posouzení ohrožení zabezpečení spravované databáze.<br/>Nejdřív nastavte základní hodnotu před použitím této rutiny k jejímu vymazání. |
| [Clear – AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Clear – AzSqlInstanceVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení spravované instance. |
| [Convert – AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Převede výsledky kontroly vyhodnocování ohrožení zabezpečení databáze na excelový soubor. |
| [Convert – AzSqlInstanceDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Převede výsledky kontroly vyhodnocování ohrožení zabezpečení spravované databáze na excelový soubor. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Získá směrný plán pravidla posouzení ohrožení zabezpečení databáze pro dané pravidlo. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Získá standardní hodnotu pravidla posouzení ohrožení zabezpečení spravované databáze pro dané pravidlo. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Získá všechny záznamy kontroly posouzení ohrožení zabezpečení přidružené k dané databázi. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Získá všechny záznamy kontroly posouzení ohrožení zabezpečení přidružené k dané spravované databázi. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Vrátí nastavení posouzení ohrožení zabezpečení databáze. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Vrátí nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Nastaví směrný plán pravidla posouzení ohrožení zabezpečení. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Nastaví směrný plán pravidla posouzení ohrožení zabezpečení pro spravovanou databázi. |
| [Spustit – AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Spustí začátek kontroly posouzení ohrožení zabezpečení v databázi. |
| [Spustit – AzSqlInstanceDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Spustí začátek kontroly posouzení ohrožení zabezpečení ve spravované databázi. |
| [Update – AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení databáze. |
| [Update – AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Update – AzSqlInstanceVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení spravované instance. |
| &nbsp; | &nbsp; |

Příklad skriptu najdete v tématu [Podpora PowerShellu pro posouzení ohrožení zabezpečení Azure SQL](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Správa pravidel standardních hodnot posouzení ohrožení zabezpečení pomocí Správce prostředků šablon

Chcete-li konfigurovat směrné plány pro posouzení ohrožení zabezpečení pomocí Azure Resource Manager šablon, použijte `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` typ.

Před přidáním standardních hodnot se ujistěte, že jste povolili `vulnerabilityAssessments` .

Tady je příklad, jak definovat pravidlo standardních hodnot VA2065 do `master` databáze a VA1143 do `user` databáze jako prostředky v šabloně správce prostředků:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

`master`V případě databáze a `user` databáze jsou názvy prostředků definované odlišně:

- Hlavní databáze-"název": "[Concat (Parameters (' server_name '); '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]";
- Uživatelská databáze-"název": "[Concat (Parameters (' server_name '), '/', parametry (' database_name '), '/default/VA2065/<b>Default</b>')]";

Pro zpracování logických typů jako true/false nastavte výsledek směrného plánu s binárním vstupem jako "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Další kroky  

- Přečtěte si další informace o [Azure Defenderu pro SQL](azure-defender-for-sql.md).
- Přečtěte si další informace o [zjišťování a klasifikaci dat](data-discovery-and-classification-overview.md).
- Další informace o [ukládání výsledků kontroly posouzení ohrožení zabezpečení v účtu úložiště přístupném za brány firewall a virtuální sítě](sql-database-vulnerability-assessment-storage.md).
