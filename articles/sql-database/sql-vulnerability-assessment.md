---
title: Posouzení ohrožení zabezpečení SQL
description: Naučte se konfigurovat a vyhodnocovat zranitelnosti zabezpečení SQL na SQL Database a interpretovat sestavy hodnocení.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 03/12/2019
ms.openlocfilehash: f67882d51c14b50c8a65120b663096d08363d07d
ms.sourcegitcommit: dfa543fad47cb2df5a574931ba57d40d6a47daef
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/18/2020
ms.locfileid: "77431447"
---
# <a name="sql-vulnerability-assessment-service-helps-you-identify-database-vulnerabilities"></a>Služba posouzení ohrožení zabezpečení SQL vám pomůže identifikovat slabá místa databáze.

Posouzení ohrožení zabezpečení SQL je snadnou konfigurací služby, která může zjišťovat, sledovat a pomáhat při nápravě potenciálních ohrožení zabezpečení databáze. Můžete ji aktivně využít ke zlepšení zabezpečení vaší databáze.

Posouzení ohrožení zabezpečení je součástí nabídky [Rozšířené služby Data Security](sql-database-advanced-data-security.md) (ADS), což je jednotný balíček pro pokročilé funkce zabezpečení SQL. Posouzení ohrožení zabezpečení je dostupné a spravované prostřednictvím portálu centrálních SQL ADS.

> [!NOTE]
> Posouzení ohrožení zabezpečení je podporované pro Azure SQL Database, Azure SQL Managed instance a Azure SQL Data Warehouse. V zájmu jednoduchosti se v tomto článku při odkazování na některou z těchto spravovaných databázových služeb používá SQL Database.

## <a name="the-vulnerability-assessment-service"></a>Služba posouzení ohrožení zabezpečení

Posouzení ohrožení zabezpečení SQL (VA) je služba, která poskytuje přehled o stavu zabezpečení a zahrnuje akční kroky pro řešení problémů se zabezpečením a vylepšení zabezpečení databáze. Může vám to usnadnit:  

- Splnění požadavků na dodržování předpisů, které vyžadují sestavy kontroly databáze.  
- Splnění standardů ochrany osobních údajů.  
- Monitorujte dynamické databázové prostředí, kde je obtížné sledovat změny.  

Posouzení ohrožení zabezpečení je skenovací služba integrovaná do služby Azure SQL Database. Služba využívá znalostní bázi pravidel, která označují chyby zabezpečení a zvýrazňují odchylky od osvědčených postupů, jako jsou například chyby konfigurace, nadměrné oprávnění a nechráněná citlivá data. Tato pravidla jsou založená na osvědčených postupech Microsoftu a zaměřuje se na problémy zabezpečení, které představují největší rizika pro vaši databázi a jejich cenná data. Zahrnují jak problémy na úrovni databáze, tak i problémy zabezpečení na úrovni serveru, jako je nastavení brány firewall serveru a oprávnění na úrovni serveru. Tato pravidla také reprezentují mnohé z požadavků různých regulativních orgánů pro splnění standardů dodržování předpisů.  

Výsledky kontroly zahrnují akční kroky k vyřešení jednotlivých problémů a v případě potřeby vám poskytnou přizpůsobené skripty pro nápravu. Sestavu posouzení je možné přizpůsobit pro vaše prostředí nastavením přijatelného směrného plánu pro konfigurace oprávnění, konfigurace funkcí a nastavení databáze.

## <a name="implementing-vulnerability-assessment"></a>Implementace posouzení ohrožení zabezpečení

Následující kroky implementují VA v SQL Database.  

### <a name="1-run-a-scan"></a>1. spustit kontrolu  

Začněte s nástrojem VA a přejděte k **pokročilým datům zabezpečení dat** v záhlaví zabezpečení v podokně Azure SQL Database. Kliknutím povolíte rozšířené zabezpečení dat a potom kliknete na **vybrat úložiště** nebo na kartě **posouzení ohrožení zabezpečení** , které automaticky otevře kartu nastavení posouzení ohrožení zabezpečení pro celý SQL Server.

Začněte tím, že nakonfigurujete účet úložiště, ve kterém se budou ukládat výsledky kontroly pro všechny databáze na serveru. Informace o účtech úložiště najdete v tématu informace [o účtech úložiště Azure](../storage/common/storage-create-storage-account.md). Jakmile je úložiště nakonfigurované, klikněte na tlačítko **Vyhledat** a vyhledejte v databázi chyby zabezpečení.
  
![Kontrola databáze](./media/sql-vulnerability-assessment/pp_va_initialize.png)  

  > [!NOTE]
  > Kontrola je odlehčená a bezpečná. Spuštění bude trvat několik sekund a je výhradně pro čtení. Neprovádí žádné změny v databázi.  

### <a name="2-view-the-report"></a>2. zobrazení sestavy

Po dokončení kontroly se sestava kontroly automaticky zobrazí v Azure Portal. V sestavě se zobrazí přehled stavu zabezpečení: kolik problémů bylo nalezeno a jejich příslušných závažnosti. Výsledky zahrnují upozornění na odchylky od osvědčených postupů a snímek nastavení souvisejících se zabezpečením, jako jsou například objekty zabezpečení databáze a role a jejich přidružená oprávnění. Zpráva o kontrole taky poskytuje mapu citlivých dat zjištěných ve vaší databázi a obsahuje doporučení ke klasifikaci těchto dat pomocí [klasifikace & Discovery Data](sql-database-data-discovery-and-classification.md).

![Zobrazení sestavy](./media/sql-vulnerability-assessment/pp_main_getstarted.png)  

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analyzujte výsledky a vyřešte problémy.

Zkontrolujte výsledky a určete zjištění v sestavě, které mají ve vašem prostředí skutečné problémy se zabezpečením. Pokud chcete zjistit dopad hledání a proč se jednotlivá kontrola zabezpečení nezdařila, přejděte k podrobnostem každého neúspěšného výsledku. K vyřešení tohoto problému použijte informace o nápravě, které poskytuje tato sestava.  

![Analyzovat sestavu](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. nastavení standardních hodnot

Při kontrole výsledků hodnocení můžete označit konkrétní výsledky jako přijatelné *standardní hodnoty* ve vašem prostředí. Směrný plán je v podstatě přizpůsobením způsobu hlášení výsledků. Výsledky, které se shodují se směrným plánem, se považují za při následné kontrole. Jakmile zadáte svůj základní stav zabezpečení, zapíše VA jenom sestavy odchylek od standardních hodnot a Vy se můžete zaměřit na důležité problémy.  

![Nastavení standardních hodnot](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)  

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Spusťte novou kontrolu, aby se zobrazila vaše přizpůsobená sestava sledování.

Po dokončení nastavení **standardních hodnot pravidel**spusťte novou kontrolu a zobrazte přizpůsobenou sestavu. Hodnota VA nyní hlásí pouze bezpečnostní problémy, které se odchylují od schváleného stavu směrného plánu.

![Zobrazit přizpůsobenou sestavu](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)  

Posouzení ohrožení zabezpečení se teď dá použít k monitorování, jestli vaše databáze udržuje vysokou úroveň zabezpečení a jestli jsou splněné zásady vaší organizace. Pokud jsou požadovány sestavy o dodržování předpisů, může být pro usnadnění procesu dodržování předpisů užitečná zpráva VA.  

### <a name="6-set-up-periodic-recurring-scans"></a>6. nastavení pravidelného opakovaného prohledávání

Pokud chcete zapnout **pravidelné opakované kontroly**, přejděte k nastavení posouzení ohrožení zabezpečení. Tím se nakonfiguruje posouzení ohrožení zabezpečení pro automatické spuštění prohledávání databáze jednou za týden. Na e-mailové adresy, které poskytnete, se pošle souhrn výsledků kontroly.

![Zobrazit přizpůsobenou sestavu](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Export hodnotící sestavy

Kliknutím na **Exportovat výsledky kontroly** vytvoříte sestavu ke stažení v aplikaci Excel s výsledky kontroly. Tato sestava obsahuje kartu Souhrn, která zobrazuje souhrn posouzení, včetně všech neúspěšných kontrol. Obsahuje také kartu **výsledky** obsahující úplnou sadu výsledků kontroly, včetně všech kontrol, které byly spuštěny, a podrobností výsledku pro každý z nich.

### <a name="8-view-scan-history"></a>8. Zobrazit historii prohledávání

Kliknutím na **Historie prohledávání** v podokně VA zobrazíte historii všech kontrol, které byly dříve spuštěny v této databázi. Kliknutím na konkrétní kontrolu v seznamu zobrazíte podrobné výsledky této kontroly.

Posouzení ohrožení zabezpečení se teď dá použít k monitorování, jestli vaše databáze udržuje vysokou úroveň zabezpečení a jestli jsou splněné zásady vaší organizace. Pokud jsou požadovány sestavy o dodržování předpisů, může být pro usnadnění procesu dodržování předpisů užitečná zpráva VA.

## <a name="manage-vulnerability-assessments-using-azure-powershell"></a>Správa posouzení ohrožení zabezpečení pomocí Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Modul PowerShell Azure Resource Manager je stále podporován Azure SQL Database, ale všechny budoucí vývojové prostředí jsou pro modul AZ. SQL. Tyto rutiny naleznete v tématu [AzureRM. SQL](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Argumenty pro příkazy v modulech AZ a v modulech AzureRm jsou v podstatě identické.

Pomocí rutin Azure PowerShell můžete programově spravovat posouzení ohrožení zabezpečení. Podporované rutiny jsou:

- [Update – AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Aktualizuje nastavení posouzení ohrožení zabezpečení databáze.
- [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Vrátí nastavení posouzení ohrožení zabezpečení databáze.
- [Clear – AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Vymaže nastavení posouzení ohrožení zabezpečení databáze.
- [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Nastaví směrný plán pravidla posouzení ohrožení zabezpečení.
- [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Získá směrný plán pravidla posouzení ohrožení zabezpečení pro dané pravidlo.
- [Clear – AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Vymaže směrný plán pravidla posouzení ohrožení zabezpečení. Před použitím této rutiny nejdřív nastavte základní hodnotu a vymažte ji.
- [Spustit – AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Spustí začátek kontroly posouzení ohrožení zabezpečení.
- [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Získá všechny záznamy kontroly vyhodnocení ohrožení zabezpečení, které jsou přidružené k dané databázi.
- [Convert – AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Převede výsledky kontroly vyhodnocování ohrožení zabezpečení do excelového souboru.

Příklad skriptu najdete v tématu [Podpora PowerShellu pro posouzení ohrožení zabezpečení Azure SQL](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessments-baseline-rules-using-azure-resource-manager-templates"></a>Správa pravidel standardních hodnot zabezpečení pomocí Azure Resource Manager šablon

Při posuzování zabezpečení configurng pomocí šablon Azure Resource Manager musíte použít typ `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Před přidáním standardních hodnot Ujistěte se, že jste povolili vulnerabilityAssements na SQL Server.

Viz příklad definování pravidla standardních hodnot VA2065 do masterdb a VA1143 userdb pro jako prostředků v ARM – šablony:

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Pro uživatelskou databázi a hlavní databázi jsou názvy prostředků definované odlišně:

* Hlavní databáze-"název": "[Concat (Parameters (' server_name '); '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]";
* Uživatelská databáze-"název": "[Concat (Parameters (' server_name '), '/', parametry (' database_name '), '/default/VA2065/<b>Default</b>')]";
 
## <a name="next-steps"></a>Další kroky  

- Další informace o [pokročilém zabezpečení dat](sql-database-advanced-data-security.md)
- Další informace o [klasifikaci & Discovery Data](sql-database-data-discovery-and-classification.md)
