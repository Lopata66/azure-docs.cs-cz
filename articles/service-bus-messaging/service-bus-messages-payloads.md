---
title: Zprávy azure service bus, datové části a serializace | Dokumenty společnosti Microsoft
description: Tento článek obsahuje přehled zpráv Azure Service Bus, datové části, směrování zpráv a serializace.
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2020
ms.author: aschhab
ms.openlocfilehash: 11e56ae2483a254fb00e3593da7841f3f3d844f3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/27/2020
ms.locfileid: "76759393"
---
# <a name="messages-payloads-and-serialization"></a>Zprávy, datové části a serializace

Microsoft Azure Service Bus zpracovává zprávy. Zprávy nesou datovou část i metadata ve formě vlastností páru klíč hodnota, popisující datovou část a dává pokyny pro zpracování Service Bus a aplikací. V některých případů tato metadata sama o sobě je dostatečná k přenosu informací, které odesílatel chce komunikovat s příjemci a datové části zůstane prázdný.

Objektový model oficiálních klientů Service Bus pro .NET a Java odráží abstraktní strukturu zpráv Service Bus, která je mapována na a z drátových protokolů, které service bus podporuje.
 
Zpráva service bus se skládá z binární datové části části, kterou service bus nikdy zpracovává v žádné formě na straně služby a dvě sady vlastností. *Vlastnosti zprostředkovatele* jsou předdefinovány systémem. Tyto předdefinované vlastnosti řídí funkce na úrovni zprávy uvnitř zprostředkovatele nebo mapují na běžné a standardizované položky metadat. *Vlastnosti uživatele* jsou kolekce párů klíč hodnota, které mohou být definovány a nastaveny aplikací.
 
Předdefinované vlastnosti zprostředkovatele jsou uvedeny v následující tabulce. Názvy se používají se všemi oficiálními klientskými rozhraními API a také s objektem [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON mapování protokolu HTTP.
 
Ekvivalentní názvy použité na úrovni protokolu AMQP jsou uvedeny v závorce. 

| Název vlastnosti                         | Popis                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (typ obsahu)           | Volitelně popisuje datovou část zprávy s popisovacím podle formátu RFC2045, Oddíl 5; například `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (id korelace)       | Umožňuje aplikaci zadat kontext pro zprávu pro účely korelace; například odráží **MessageId** zprávy, která je právě odpověděl.                                                                                                                                                                                                                                                                  |
| [Zdroj mrtvého dopisu](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Nastavit pouze ve zprávách, které byly nedoručené a následně automaticky předány z fronty nedoručených zpráv do jiné entity. Označuje entitu, ve které byla zpráva nedoručena. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                  |
| [Počet dodávek](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Počet dodávek, které byly pokusu o tuto zprávu. Počet se zintáží při vypršení platnosti zámku zprávy nebo zpráva je explicitně opuštěnpříjemce. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | U zpráv, které byly automaticky předány dál, tato vlastnost odráží pořadové číslo, které bylo nejprve přiřazeno ke zprávě v původním bodě odeslání. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | Okamžik UTC, ve kterém byla zpráva přijata a uložena v entitě. Tuto hodnotu lze použít jako autoritativní a neutrální indikátor času příjezdu, když příjemce nechce důvěřovat hodinám odesílatele. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                   |
|  [ExpiresAtUtc (absolutní expirace)ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolute-expiry-time) ExpiresAtUtc (absolute-expiry-time) | Okamžik UTC, při kterém je zpráva označena pro odebrání a již není k dispozici pro načtení z entity z důvodu vypršení jeho platnosti. Expirace je řízena **Vlastností TimeToLive** a tato vlastnost je vypočítána z EnqueuedTimeUtc+TimeToLive. Tato vlastnost je jen ke čtení.                                                                                                                                                                           |
| [SílaPersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Pro fronty nebo témata, které mají nastaven [příznak EnableExpress,](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) lze tuto vlastnost nastavit tak, aby označovala, že zpráva musí být na disk ustálena, než bude potvrzena. Toto je standardní chování pro všechny neexpresní entity.                                                                                                                                                                                                         |
| [Popisek](/dotnet/api/microsoft.azure.servicebus.message.label) (předmět)                       | Tato vlastnost umožňuje aplikaci označit účel zprávy příjemci standardizovaným způsobem, podobně jako řádek předmětu e-mailu.                                                                                                                                                                                                                                                                                  |
| [UzamčenoUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Pro zprávy načtené pod zámkem (peek-lock režim příjmu, není předem vyrovnány) tato vlastnost odráží UTC okamžik, dokud je zpráva držena uzamčena ve frontě/odběr. Když vyprší platnost [zámku, DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) je přírůstek a zpráva je opět k dispozici pro načtení. Tato vlastnost je jen ke čtení.                                                                                                                         |
| [Token zámku](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Token zámku je odkaz na zámek, který je držen zprostředkovatelem v *režimu příjem peek lock.* Token lze použít k připnutí zámku trvale prostřednictvím rozhraní API [časově rozlišení](message-deferral.md) a s tím, převzít zprávu z pravidelného toku stavu doručení. Tato vlastnost je jen ke čtení.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (id zprávy)                | Identifikátor zprávy je hodnota definovaná aplikací, která jednoznačně identifikuje zprávu a její datovou část. Identifikátor je řetězec volného tvaru a může odrážet identifikátor GUID nebo identifikátor odvozený z kontextu aplikace. Pokud je tato možnost povolena, funkce [vyhledávání duplicit](duplicate-detection.md) identifikuje a odebere druhé a další odeslání zpráv se stejným **Id .**                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | U [rozdělených entit](service-bus-partitioning.md)umožňuje nastavení této hodnoty přiřazení souvisejících zpráv ke stejnému internímu oddílu, aby bylo správně zaznamenáno pořadí posloupnosti odeslání. Oddíl je vybrán funkcí hash nad tuto hodnotu a nelze jej zvolit přímo. U entit podporujících relaci vlastnost **SessionId** tuto hodnotu přepíše.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (odpověď na)                    | Tato volitelná hodnota definovaná aplikací je standardní způsob vyjádření cesty odpovědi příjemci zprávy. Pokud odesílatel očekává odpověď, nastaví hodnotu na absolutní nebo relativní cestu fronty nebo tématu, které očekává, že odpověď bude odeslána.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (odpověď na id skupiny)  | Tato hodnota rozšiřuje **ReplyTo** informace a určuje, které **SessionId** by měla být nastavena pro odpověď při odeslání do entity odpovědi.                                                                                                                                                                                                                                                                            |
| [NaplánovánoEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Pro zprávy, které jsou k dispozici pouze pro načtení po zpoždění, tato vlastnost definuje utc okamžik, kdy bude zpráva logicky zařazena do fronty, sekvencovány a proto k dispozici pro načtení.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Pořadové číslo je jedinečné 64bitové celé číslo přiřazené ke zprávě, protože je přijato a uloženo zprostředkovatelem a funguje jako jeho skutečný identifikátor. Pro rozdělené entity nejvyšší 16 bitů odráží identifikátor oddílu. Pořadová čísla se zvyšují a jsou bez mezer. Převrátí se na 0, když je vyčerpán rozsah 48-64 bitů. Tato vlastnost je jen ke čtení.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (id skupiny)                  | Pro entity podporující relaci určuje tato hodnota definovaná aplikací umístění relace zprávy. Zprávy se stejným identifikátorem relace podléhají souhrnnému uzamčení a umožňují přesné zpracování v pořadí a demultiplexování. U entit, které nejsou informovány o relaci, je tato hodnota ignorována.                                                                                                                                     |
| [Velikost](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Odráží uloženou velikost zprávy v protokolu zprostředkovatele jako počet bajtů, protože se započítává do kvóty úložiště. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                                                                                       |
| [Stav](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Označuje stav zprávy v protokolu. Tato vlastnost je relevantní pouze během procházení zpráv ("náhled"), k určení, zda je zpráva "aktivní" a je k dispozici pro načtení, když dosáhne vrcholu fronty, zda je odloženo nebo čeká na naplánování. Tato vlastnost je jen ke čtení.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Tato hodnota je relativní doba trvání, po které vyprší platnost zprávy, počínaje okamžikem, kdy byla zpráva přijata a uložena zprostředkovatelem, jak je zachyceno v **EnqueueTimeUtc**. Pokud není nastavena explicitně, předpokládaná hodnota je **DefaultTimeToLive** pro příslušnou frontu nebo téma. Hodnota **TimeToLive** na úrovni zprávy nemůže být delší než nastavení **DefaultTimeToLive** entity. Pokud je delší, je tiše nastavena. |
| [Do](/dotnet/api/microsoft.azure.servicebus.message.to) (do)                               | Tato vlastnost je vyhrazena pro budoucí použití ve scénářích směrování a aktuálně ignorována samotným zprostředkovatelem. Aplikace můžete použít tuto hodnotu v scénářích automatického předávání založené na pravidlech k označení zamýšleného logického cíle zprávy.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Pokud je zpráva odeslána prostřednictvím fronty přenosu v rozsahu transakce, tato hodnota vybere oddíl fronty přenosu.                                                                                                                                                                                                                                                                                                                 |

Model abstraktní zprávy umožňuje zprávu, která má být zaúčtována do fronty přes HTTP (vlastně vždy HTTPS) a lze je načíst prostřednictvím AMQP. V obou případech zpráva vypadá normálně v kontextu příslušného protokolu. Vlastnosti zprostředkovatele jsou přeloženy podle potřeby a vlastnosti uživatele jsou mapovány na nejvhodnější umístění v příslušném modelu zprávy protokolu. V protokolu HTTP jsou vlastnosti uživatele mapovány přímo do a ze záhlaví protokolu HTTP. v AMQP mapují na a z mapy **vlastností aplikace.**

## <a name="message-routing-and-correlation"></a>Směrování zpráv a korelace

Podmnožina vlastností broker popsaných dříve, konkrétně [Na](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid)a [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), se používají k pomoci aplikacím směrovat zprávy do konkrétních cílů. Pro ilustraci to zvažte několik vzorů:

- **Jednoduchý požadavek/odpověď**: Vydavatel odešle zprávu do fronty a očekává odpověď od příjemce zprávy. Chcete-li obdržet odpověď, vydavatel vlastní frontu, do které očekává, že odpovědi budou doručeny. Adresa této fronty je vyjádřena ve vlastnosti **ReplyTo** odchozí zprávy. Když příjemce odpoví, zkopíruje **MessageId** zpracované zprávy do **CorrelationId** vlastnost odpovědi a doručí zprávu do cíle označené **ReplyTo** vlastnost. Jedna zpráva může přinést více odpovědí, v závislosti na kontextu aplikace.
- **Požadavek/odpověď vícesměrového vysílání**: Jako variantu předchozího vzoru odešle vydavatel zprávu do tématu a více odběratelů bude mít nárok na využití zprávy. Každý z odběratelů může reagovat způsobem popsaným dříve. Tento vzor se používá ve scénářích zjišťování nebo roll-call a respondent se obvykle identifikuje s vlastností uživatele nebo uvnitř datové části. Pokud **ReplyTo** odkazuje na téma, taková sada odpovědí zjišťování může být distribuována cílové skupině.
- **Multiplexování**: Tato funkce relace umožňuje multiplexování datových proudů souvisejících zpráv prostřednictvím jedné fronty nebo předplatného tak, aby každá relace (nebo skupina) souvisejících zpráv, identifikované odpovídajícími hodnotami **SessionId,** byla směrována konkrétnímu příjemci, zatímco příjemce drží relaci pod zámkem. Přečtěte si více o podrobnostech zasedání [zde](message-sessions.md).
- **Multiplexní požadavek/odpověď**: Tato funkce relace umožňuje multiplexní odpovědi, což umožňuje několika vydavatelům sdílet frontu odpovědí. Nastavením **ReplyToSessionId**může vydavatel dát spotřebiteli pokyn ke zkopírování této hodnoty do vlastnosti **SessionId** odpovědi. Fronta publikování nebo téma nemusí být uvědomělý z relace. Jako zpráva je odeslána, vydavatel pak může konkrétně čekat na relaci s danou **SessionId** zhmotnit ve frontě podmíněně přijetím relace příjemce. 

Směrování uvnitř oboru názvů Service Bus lze realizovat pomocí pravidla automatického přeposílání řetězení a tématu odběr. Směrování mezi obory názvů lze realizovat [pomocí Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Jak je uvedeno v předchozím seznamu, **To** vlastnost je vyhrazena pro budoucí použití a může být nakonec interpretován zprostředkovatelem se speciálně povolenou funkcí. Aplikace, které chtějí implementovat směrování by tak učinit na základě vlastností uživatele a neopřít o **To** vlastnost; Pokud tak však učiníte nyní, nezpůsobíte problémy s kompatibilitou.

## <a name="payload-serialization"></a>Serializace datové části

Při přenosu nebo uložené uvnitř service bus, datová část je vždy neprůhledné, binární blok. [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) Vlastnost umožňuje aplikacím popsat datovou část, s navrhovaný formát pro hodnoty vlastností je popis typu obsahu MIME podle IETF RFC2045; například `application/json;charset=utf-8`.

Na rozdíl od variant Java nebo .NET Standard podporuje verze rozhraní API rozhraní Service Bus Framework rozhraní (Rozhraní API služby **BrokeredMessage"** tím, že do konstruktoru předává libovolné objekty .NET. 

Při použití staršího protokolu SBMP jsou tyto objekty serializovány s výchozím binárním serializátorem nebo serializátorem, který je dodán externě. Při použití protokolu AMQP je objekt serializován do objektu AMQP. Příjemce můžete načíst tyto objekty s [GetBody\<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) metoda, zadání očekávaného typu. S AMQP objekty jsou serializovány do grafu AMQP **ArrayList** a **IDictionary<řetězec,objekt>** objekty a každý klient AMQP je může dekódovat. 

Zatímco tato skrytá serializace magie je pohodlné, aplikace by měly mít explicitní kontrolu serializace objektu a převést jejich objekt grafy do datových proudů před jejich zahrnutído zprávy a to naopak na straně příjemce. To přináší interoperabilní výsledky. Je třeba také poznamenat, že zatímco AMQP má výkonný binární kódovací model, je vázána na ekosystém zasílání zpráv AMQP a http klienti budou mít potíže s dekódováním těchto datových částí. 

Obecně doporučujeme JSON a Apache Avro jako formáty datové části pro strukturovaná data.

Varianty rozhraní .NET Standard a Java API přijímají pouze bajtová pole, což znamená, že aplikace musí zpracovávat ovládací prvek serializace objektů. 

## <a name="next-steps"></a>Další kroky

Další informace o zasílání zpráv služby Service Bus najdete v následujících tématech:

* [Fronty, témata a odběry služby Service Bus](service-bus-queues-topics-subscriptions.md)
* [Začínáme s frontami služby Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Jak používat témata a odběry Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
